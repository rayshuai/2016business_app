bApp.controller("chooseServiceController",["$scope","accountDom","registerInfo","$state",function(a,b,c,d){a.noCardService=function(){b.chosenService("service-nocard"),b.cancelService("service-card")},a.cardService=function(){b.chosenService("service-card"),b.cancelService("service-nocard")},a.goToRegister=function(a){"nocard"==a?(c.service_type=1,d.go("account.register")):"card"==a&&(c.service_type=2,d.go("error.coding"))}}]),bApp.controller("registerController",["$scope","accountDom","registerInfo","$state","$http",function(a,b,c,d,e){a.form={business_name:"",business_phone:"",business_show_address:"",business_address:"请在地图中标记店铺的位置",lng:"",lat:"",business_des:"",category:"",host_name:"",host_phone:"",host_pass:""},a.business_type=[{name:"运动"},{name:"餐饮"},{name:"购物"},{name:"休闲"}],a.pic="";var f;a.searchList=[],a.searchCondition="",a.setCondition=function(c){clearInterval(f),a.searchCondition=c,a.searchList=[],b.search.call(b,c)},a.setListTimer=function(){f=setInterval(function(){a.searchList=b.getList()},1e3)},a.search=function(){clearInterval(f),b.search(a.searchCondition)},a.confirmMap=function(){a.form.business_address=a.searchCondition},a.$on("$viewContentLoaded",function(){0==c.service_type?d.go("account.services"):b.initMap()}),a.openMap=function(){b.openMap()},a.results,a.registerAll=function(){var b={id:0,owner_name:a.form.host_name,owner_telephone:a.form.host_phone,owner_password:a.form.host_pass,name:a.form.business_name,phone:a.form.business_phone,description:a.form.business_des,category:a.form.category.name,address:a.form.business_show_address,address_province:c.province,address_city:c.city,address_district:c.district,address_street:c.street,coord_long:c.coord_long,coord_lat:c.coord_lat,service_type:c.service_type,picture:a.pic,restrain:""};e.post("http://115.159.45.39/api/storereg",b).success(function(a){console.log(a),alert("您的注册信息已经提交，请等待客服的联系"),d.go("account.login")}).error(function(a,b){console.log(a,b)})}}]),bApp.controller("loginController",["$scope","$state","$http","$window",function(a,b,c,d){a.formInfo={account:"",pass:"",remember:!1},a.goToService=function(){b.go("account.services")},a.login=function(){var e="http://115.159.45.39/api/storelogin",f={username:a.formInfo.account,password:a.formInfo.pass};c({method:"POST",url:e,data:f}).success(function(a){d.localStorage.store=JSON.stringify(a),b.go("home.admin.cashier")}).error(function(a,b){alert("账户或密码出错！"),console.log(a,b)})}}]),bApp.controller("cashierController",["$scope","$http","$window",function(a,b,c){var d=["银卡","金卡","钻石卡","至尊卡"],e="http://115.159.45.39";a.userId="",a.isQuery=!1,a.isUser=!1,a.showUser={id:0,name:"",level:"",birthday:"",point:0,discount:1,exchange:1},a.cost,a.discount,a.point,a.info,a.$on("$viewContentLoaded",function(){}),a.calculate=function(){console.log(a.cost),isNaN(a.cost)?alert("请输入正确的金额"):(a.discount=a.cost*a.showUser.discount,a.discount=a.discount.toFixed(1),a.point=Math.floor(a.cost*a.showUser.exchange))},a.lookForUser=function(){var f=e+"/api/cashierInfo/";JSON.parse(c.localStorage.store);b.get(f+a.userId).success(function(b){console.log(b),a.showUser.id=b.userId,a.showUser.name=b.username,a.showUser.level=d[b.level],a.showUser.point=b.point,a.showUser.birthday=b.birthday,a.showUser.discount=b.discount,a.showUser.exchange=b.exchange,a.isUser=!0,a.isQuery=!0}).error(function(b){console.log(b),a.isQuery=!0})},a.settlement=function(){var c=e+"/api/pointDetail",d={id:0,userId:a.showUser.id,storeId:161,detail:"消费"+a.cost+"元",alteration:a.point,note:a.info,time:"2016-12-26 15:50:02"};b.post(c,d).success(function(b){a.isQuery=!1,a.isUser=!1,a.userId="",a.cost=void 0,a.discount=void 0,a.point=void 0,a.info=void 0,alert("消费成功！")}).error(function(a){alert("服务故障，请稍后重试！"),console.log(a)})}}]),bApp.controller("memberController",["$scope","$http","$window",function(a,b,c){var d="http://115.159.45.39";a.levels=["银卡会员","金卡会员","钻石卡会员","至尊卡会员"];var e=JSON.parse(c.localStorage.store);a.memberList,a.memberLevel,a.search="",a.$on("$viewContentLoaded",function(){f(),g()});var f=function(){var c=d+"/api/memberWithUser/store";b.get(c).success(function(b){a.memberList=b}).error(function(a,b){console.log(a,b)})},g=function(){var c=d+"/api/memberLevel/store/"+e.id;b.get(c).success(function(b){a.memberLevel=b}).error(function(a,b){console.log(a,b)})};a.modifyLevel=function(c){var e=d+"/api/memberLevel/"+a.memberLevel[c].id;b.put(e,a.memberLevel[c]).success(function(a){console.log(a),g(),alert("修改成功")}).error(function(a,b){console.log(a,b)})}}]),bApp.controller("giftManageController",["$scope","$http","$window",function(a,b,c){var d,e="http://115.159.45.39",f=JSON.parse(c.localStorage.store);a.giftList,a.chosenGift,a.gift={id:0,storeId:f.id,name:"",point:"",money:"",stock:0,picture:"/public/img/gift_default.png"},a.isShowGift=!1,a.$on("$viewContentLoaded",function(){g()}),a.pic="";var g=function(){var c="http://115.159.45.39/api/gift/store/";b.get(c+f.id).success(function(b){console.log(b),a.giftList=b}).error(function(a){console.log(a)})};a.showGift=function(b){a.isShowGift=!0,a.chosenGift=a.giftList[b],a.chosenGift&&(d=b),console.log(a.chosenGift)},a.modifyGift=function(){var c=e+"/api/gift/"+a.chosenGift.id;b.put(c,a.chosenGift).success(function(b){a.giftList[d]=b,alert("礼品信息修改成功")}).error(function(a,b){console.log(a,b)}),a.isShowGift=!1},a.addGift=function(){var c=e+"/api/gift";a.gift.picture=a.pic,console.log(a.gift),b.post(c,a.gift).success(function(b){a.gift={id:0,storeId:f.id,name:"",point:"",money:"",stock:0,picture:""},g(),alert("添加成功")}).error(function(a,b){console.log(a,b)})},a.deleteGift=function(c,d){d.stopPropagation();var f=e+"/api/gift/"+a.chosenGift.id;b.delete(f).success(function(b){a.giftList.splice(c,1),a.chosenGift=null,alert("删除成功")}).error(function(a,b){console.log(a,b)})},a.card,a.clickCard=!1,a.isInfo=!1,a.cardInfo,a.getCardInfo=function(){var c=e+"/api/exchangeTicket/store?code="+a.card;b.get(c).success(function(b){a.clickCard=!0,a.isInfo=!0,console.log(b),a.cardInfo=b}).error(function(b,c){a.clickCard=!0,console.log(b,c)})},a.exchangeCard=function(){var c=e+"/api/applyForGift/exchange/"+a.cardInfo.applyForGiftId;b.put(c).success(function(b){console.log(b),a.clickCard=!1,a.isInfo=!1,a.card="",g(),alert("成功兑换！")}).error(function(a,b){console.log(a,b)})}}]),bApp.controller("shopInfoController",function(a,b,c,d){var e="http://115.159.45.39";d.$on("$viewContentLoaded",function(){d.store=JSON.parse(c.localStorage.store),f(),d.getMembers()}),d.preInfo,d.modifyStore=function(){var a=e+"/api/store/"+d.store.id;b.put(a,d.store).success(function(a){c.localStorage.store=JSON.stringify(a),alert("信息修改成功")}).error(function(a,b){console.log(a,b)})},d.modifyPre=function(){var a=e+"/api/preferential/"+d.store.id;d.put(a,d.preInfo).success(function(a){d.preInfo=a,""!==d.preInfo.noteString&&""===d.store.description&&(d.store.description=d.preInfo.noteString)}).error(function(a,b){console.log(a,b)})};var f=function(){var a=e+"/api/preferential/"+d.store.id;b.get(a).success(function(a){d.preInfo=a,""!==d.preInfo.noteString&&""===d.store.description&&(d.store.description=d.preInfo.noteString)}).error(function(a,b){console.log(a,b)})};d.members=[],d.getMembers=function(){var a=e+"/api/applyForMemberWithUser/store";b.get(a).success(function(a){console.log(a),d.members=a,void 0===a[0]&&setTimeout(function(){alert("暂无新会员申请")},2e3)}).error(function(a,b){console.log(a,b)})},d.addMember=function(a){var c=e+"/api/applyForMember/"+d.members[a].id;d.members[a].status=1,delete d.members[a].username,b.put(c,d.members[a]).success(function(b){console.log(b),d.members.splice(a,1),alert("已成功！")}).error(function(a,b){console.log(a,b)})},d.deleteMember=function(a){var c=e+"/api/applyForMember/"+d.members[a].id;d.members[a].status=0,delete d.members[a].username,b.put(c,d.members[a]).success(function(b){console.log(b),d.members.splice(a,1),alert("已成功！")}).error(function(a,b){console.log(a,b)})}}),bApp.controller("vipController",["$scope","$http",function(a,b){a.pic=""}]);